<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Lab Activities - Terraform & Ansible Intro</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Lab Activities";
    var mkdocs_page_input_path = "terraform-lab.md";
    var mkdocs_page_url = "/terraform-lab/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Terraform & Ansible Intro</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Setup</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting-started/">Getting Started</a>
                </li>
                <li class="">
                    
    <a class="" href="../configuration/">Configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../deployment/">Deployment</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Terraform Lab</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../terraform-background/">Background</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Lab Activities</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#terraform-lab-activities">Terraform Lab Activities</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#task-1-basic-networking-config">Task 1 - Basic Networking Config</a></li>
        
            <li><a class="toctree-l4" href="#task-2-objects-and-security-rule-creation">Task 2 - Objects and Security Rule Creation</a></li>
        
            <li><a class="toctree-l4" href="#task-3-cleanup">Task 3 - Cleanup</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Ansible Lab</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../ansible-background/">Background</a>
                </li>
                <li class="">
                    
    <a class="" href="../ansible-lab/">Lab Activities</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../clean-up/">Clean Up</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../comparison/">Conclusion</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Terraform & Ansible Intro</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Terraform Lab &raquo;</li>
        
      
    
    <li>Lab Activities</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="terraform-lab-activities">Terraform Lab Activities</h1>
<p>In this activity you will:</p>
<ul>
<li>Perform basic network configuration</li>
<li>Create objects and security rules</li>
<li>Clean up the firewall configs</li>
</ul>
<h2 id="task-1-basic-networking-config">Task 1 - Basic Networking Config</h2>
<p>Change into the <code>terraform</code> directory.  We'll use it for all of our Terraform files.</p>
<pre><code class="bash">$ cd ../terraform
</code></pre>

<p>Edit the file <code>panos_variables.tf</code> and replace the <strong>default</strong> values of the variables <code>panos_hostname</code>, <code>panos_username</code>, and <code>panos_password</code> with the appropriate values from your VM-Series instance.</p>
<pre><code class="yml">variable &quot;panos_hostname&quot; {
  description = &quot;The external IP address of the VM-Series instance&quot;
  type = &quot;string&quot;
  default = &quot;&quot;
}

variable &quot;panos_username&quot; {
  description = &quot;Username of the VM-Series administrator&quot;
  type = &quot;string&quot;
  default = &quot;&quot;
}

variable &quot;panos_password&quot; {
  description = &quot;Password of the VM-Series administrator&quot;
  type = &quot;string&quot;
  default = &quot;&quot;
}
</code></pre>

<p>Using your text editor create the file <code>panos_plan.tf</code>.  We will place our Terraform plan in this file.</p>
<p>Start by defining the provider config, which will use the <code>panos</code> provider. Note that the <code>hostname</code>, <code>username</code>, and <code>password</code> fields refer to the variables we defined in the <code>panos_variables.tf</code> file.</p>
<pre><code class="hcl">provider &quot;panos&quot; {
    hostname = &quot;${var.panos_hostname}&quot;
    username = &quot;${var.panos_username}&quot;
    password = &quot;${var.panos_password}&quot;
}
</code></pre>

<h3 id="network-interfaces">Network Interfaces</h3>
<p>Next, we will create the interfaces resources.  Here are examples of the interfaces we will be creating:</p>
<p><img alt="ethernet1/1" src="../img/eth1.png" /></p>
<p><img alt="ethernet1/2" src="../img/eth2.png" /></p>
<p>Add the following resources to <code>panos_plan.tf</code>.  Note that the <strong>ethernet1/2</strong> interface omits the option to create the default route via DHCP.</p>
<pre><code class="hcl">resource &quot;panos_ethernet_interface&quot; &quot;eth1&quot; {
    name = &quot;ethernet1/1&quot;
    vsys = &quot;vsys1&quot;
    mode = &quot;layer3&quot;
    enable_dhcp = true
    create_dhcp_default_route = true
}

resource &quot;panos_ethernet_interface&quot; &quot;eth2&quot; {
    name = &quot;ethernet1/2&quot;
    vsys = &quot;vsys1&quot;
    mode = &quot;layer3&quot;
    enable_dhcp = true
}
</code></pre>

<p>Refer to the <a href="https://www.terraform.io/docs/providers/panos/r/ethernet_interface.html">provider documentation</a> for more details on the <code>panos_ethernet_interface</code> resource.</p>
<h3 id="virtual-router">Virtual Router</h3>
<p>Now we have to associate these interfaces with the default virtual router.  Add the following configuration to <code>panos_plan.tf</code>.  The interfaces are referenced by name so that Terraform automatically knows that the interfaces will need to be created <em>before</em> the virtual router resource.</p>
<pre><code class="hcl">resource &quot;panos_virtual_router&quot; &quot;vr&quot; {
    name = &quot;default&quot;
    interfaces = [
        &quot;${panos_ethernet_interface.eth1.name}&quot;,
        &quot;${panos_ethernet_interface.eth2.name}&quot;
    ]
}
</code></pre>

<p>Refer to the <a href="https://www.terraform.io/docs/providers/panos/r/virtual_router.html">provider documentation</a> for more details on the <code>panos_virtual_router</code> resource.</p>
<h3 id="zones">Zones</h3>
<p>Next, we will create resources for security zones and reference the interfaces we added.  Here are examples of the zones we need to create:</p>
<p><img alt="L3-trust" src="../img/l3-trust.png" /></p>
<p><img alt="L3-untrust" src="../img/l3-untrust.png" /></p>
<p>Add the following configuration to <code>panos_plan.tf</code>.  The interfaces are referenced by name so that Terraform automatically knows that the interfaces will need to be created <em>before</em> the zones themselves.</p>
<pre><code class="hcl">resource &quot;panos_zone&quot; &quot;int&quot; {
    name = &quot;L3-trust&quot;
    mode = &quot;layer3&quot;
    interfaces = [&quot;${panos_ethernet_interface.eth1.name}&quot;]
}

resource &quot;panos_zone&quot; &quot;ext&quot; {
    name = &quot;L3-untrust&quot;
    mode = &quot;layer3&quot;
    interfaces = [&quot;${panos_ethernet_interface.eth2.name}&quot;]
}
</code></pre>

<p>Refer to the <a href="https://www.terraform.io/docs/providers/panos/r/zone.html">provider documentation</a> for more details on the <code>panos_zone</code> resource.</p>
<h3 id="apply-the-terraform-plan">Apply the Terraform Plan</h3>
<p>The resulting <code>panos_plan.tf</code> file should look like this:</p>
<pre><code class="hcl">provider &quot;panos&quot; {
    hostname = &quot;${var.panos_hostname}&quot;
    username = &quot;${var.panos_username}&quot;
    password = &quot;${var.panos_password}&quot;
}

resource &quot;panos_ethernet_interface&quot; &quot;eth1&quot; {
    name = &quot;ethernet1/1&quot;
    vsys = &quot;vsys1&quot;
    mode = &quot;layer3&quot;
    enable_dhcp = true
    create_dhcp_default_route = true
}

resource &quot;panos_ethernet_interface&quot; &quot;eth2&quot; {
    name = &quot;ethernet1/2&quot;
    vsys = &quot;vsys1&quot;
    mode = &quot;layer3&quot;
    enable_dhcp = true
}

resource &quot;panos_virtual_router&quot; &quot;vr&quot; {
    name = &quot;default&quot;
    interfaces = [
        &quot;${panos_ethernet_interface.eth1.name}&quot;,
        &quot;${panos_ethernet_interface.eth2.name}&quot;
    ]
}

resource &quot;panos_zone&quot; &quot;int&quot; {
    name = &quot;L3-trust&quot;
    mode = &quot;layer3&quot;
    interfaces = [&quot;${panos_ethernet_interface.eth1.name}&quot;]
}

resource &quot;panos_zone&quot; &quot;ext&quot; {
    name = &quot;L3-untrust&quot;
    mode = &quot;layer3&quot;
    interfaces = [&quot;${panos_ethernet_interface.eth2.name}&quot;]
}
</code></pre>

<p>Let's apply this config to our firewall.  You first need to run <code>terraform init</code> to download all the providers we need.</p>
<pre><code class="bash">$ terraform init
</code></pre>

<p>We'll then validate the config with <code>terraform plan</code>.</p>
<pre><code class="bash">$ terraform plan
</code></pre>

<p>If there are no errors, go ahead and push your config updates to the firewall with <code>terraform apply</code>.</p>
<pre><code class="bash">$ terraform apply
</code></pre>

<p>Log in to the web UI of your firewall and verify that the configuration matches the examples above.  Note that because of the way Terraform <em>currently</em> functions the changes have only been made to the candidate configuration and have <strong>not</strong> been committed.</p>
<hr />
<h2 id="task-2-objects-and-security-rule-creation">Task 2 - Objects and Security Rule Creation</h2>
<p>Next, we will create resources for an address object and some security rules. Here is an example of an address object we need to create:</p>
<p><img alt="Wordpress Server" src="../img/wordpress.png" /></p>
<p>Add the following to the bottom of the <code>panos_plan.tf</code> file:</p>
<pre><code class="hcl">resource &quot;panos_address_object&quot; &quot;wp&quot; {
    name = &quot;wordpress server&quot;
    description = &quot;Internal server&quot;
    value = &quot;10.1.23.45&quot;
}
</code></pre>

<p>Refer to the <a href="https://www.terraform.io/docs/providers/panos/r/address_object.html">provider documentation</a> for more details on the <code>panos_address_object</code> resource.</p>
<p>Now, here is an example of the security rules that we need to create:</p>
<p><img alt="Security Policy" src="../img/security-policy.png" /></p>
<p>Add the following to your <code>panos_plan.tf</code> file.  Just like with the networking config, zones and objects are referenced by name so that Terraform knows they need to be created before our security rules.</p>
<pre><code class="hcl">resource &quot;panos_security_rule_group&quot; &quot;policy&quot; {
    rule {
        name = &quot;Wordpress Traffic&quot;
        source_zones = [&quot;${panos_zone.ext.name}&quot;]
        source_addresses = [&quot;any&quot;]
        source_users = [&quot;any&quot;]
        hip_profiles = [&quot;any&quot;]
        destination_zones = [&quot;${panos_zone.int.name}&quot;]
        destination_addresses = [&quot;any&quot;]
        applications = [&quot;web-browsing&quot;]
        services = [&quot;application-default&quot;]
        categories = [&quot;any&quot;]
        action = &quot;allow&quot;
    }
    rule {
        name = &quot;Outbound&quot;
        source_zones = [&quot;${panos_zone.int.name}&quot;]
        source_addresses = [&quot;any&quot;]
        source_users = [&quot;any&quot;]
        hip_profiles = [&quot;any&quot;]
        destination_zones = [&quot;${panos_zone.ext.name}&quot;]
        destination_addresses = [&quot;any&quot;]
        applications = [&quot;any&quot;]
        services = [&quot;application-default&quot;]
        categories = [&quot;any&quot;]
        action = &quot;allow&quot;
    }
    rule {
        name = &quot;Default Deny&quot;
        source_zones = [&quot;any&quot;]
        source_addresses = [&quot;any&quot;]
        source_users = [&quot;any&quot;]
        hip_profiles = [&quot;any&quot;]
        destination_zones = [&quot;any&quot;]
        destination_addresses = [&quot;any&quot;]
        applications = [&quot;any&quot;]
        services = [&quot;application-default&quot;]
        categories = [&quot;any&quot;]
        action = &quot;deny&quot;
    }
}
</code></pre>

<h3 id="apply-the-terraform-plan_1">Apply the Terraform Plan</h3>
<p>Let's apply the config to our firewall.  We won't need to run <code>terraform init</code> again since the provider has already been initialized. So just check your config with <code>terraform plan</code>:</p>
<pre><code class="bash">$ terraform plan
</code></pre>

<p>If there are no errors, go ahead and push your config updates to the firewall with <code>terraform apply</code>.</p>
<pre><code class="bash">$ terraform apply
</code></pre>

<p>Switch browser tabs to the web UI of your firewall and verify that the configuration matches the examples above.  Again, the changes have only been made to the candidate configuration and have <strong>not</strong> been committed.</p>
<hr />
<h2 id="task-3-cleanup">Task 3 - Cleanup</h2>
<p>Terraform will clean up our firewall configs with the <code>terraform destroy</code> command. Run it to prepare for the Ansible portion of the lab:</p>
<pre><code class="bash">$ terraform destroy
</code></pre>

<p>Confirm in the firewall UI that the security rules, objects, and network configs we created have been removed.</p>
<p>You're now done with the Terraform portion of the lab.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ansible-background/" class="btn btn-neutral float-right" title="Background">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../terraform-background/" class="btn btn-neutral" title="Background"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../terraform-background/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ansible-background/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
